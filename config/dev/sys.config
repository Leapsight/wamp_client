[
    %% service conf
    {wamp_client, [
        {error_uris, #{
            internal_error => <<"com.myservice.error.internal">>
        }},
        {routers, #{
            bondy => #{
                hostname => "localhost",
                realm => <<"com.leapsight.test">>,
                port => 18082,
                encoding => json,
                reconnect => true,
                reconnect_max_retries => 10,
                reconnect_backoff_min => 500,
                reconnect_backoff_max => 120000,
                reconnect_backoff_type => jitter
            }
        }},
        {defaults, #{
            router => bondy,
            caller => #{
                features => #{
                    progressive_call_results => false,
                    progressive_calls => false,
                    call_timeout => true,
                    call_canceling => false,
                    caller_identification=> true,
                    call_retries => true
                },
                options => #{
                    timeout => 15000,
                    disclose_me => true
                }
            },
            callee => #{
                features => #{
                    progressive_call_results => false,
                    progressive_calls => false,
                    call_timeout => true,
                    call_canceling => false,
                    caller_identification => true,
                    call_trustlevels => true,
                    registration_revocation => true,
                    session_meta_api => true,
                    pattern_based_registration => true,
                    shared_registration => true,
                    sharded_registration => true
                },
                options => #{
                    disclose_caller => true,
                    invoke => roundrobin
                }
            },
            publisher => #{
                features => #{
                    message_retention => true,
                    publisher_exclusion => true,
                    publisher_identification => true,
                    subscriber_blackwhite_listing => true
                }
            },
            subscriber => #{
                features => #{
                    event_history => false,
                    pattern_based_subscription => true,
                    publication_trustlevels => true,
                    publisher_identification => true,
                    sharded_subscription => true
                }
            }
        }},
        {peers, #{
            bondy => #{
                router => bondy,
                realm => <<"com.leapsight.bondy">>,
                pool_size => 3,
                pool_type => hash,
                roles => #{
                    caller => #{},
                    publisher => #{},
                    callee => #{
                        features => #{},
                        registrations => #{}
                    },
                    subscriber => #{
                        features => #{},
                        subscriptions => #{}
                    }
                }
            },
            default => #{
                router => bondy,
                realm => <<"com.magenta.test">>,
                pool_size => 3,
                pool_type => hash,
                roles => #{
                    caller => #{},
                    publisher => #{},
                    callee => #{
                        features => #{},
                        registrations => #{
                            <<"com.example.add2">> => #{
                                options => #{
                                    disclose_caller => true,
                                    x_disclose_session_info => true,
                                    invoke => roundrobin
                                },
                                handler => {wamp_client_example, add}
                            },
                            <<"com.example.echo">> =>#{
                                handler => {wamp_client_example, echo}
                            },
                            <<"com.example.multiple">> =>#{
                                handler => {wamp_client_example, multiple_results}
                            },
                            <<"com.example.circular">> =>#{
                                handler => {wamp_client_example, circular}
                            },
                            <<"com.example.circular_service_error">> =>#{
                                handler => {wamp_client_example, circular_service_error}
                            },
                            <<"com.example.unknown_error">> =>#{
                                handler => {wamp_client_example, unknown_error}
                            },
                            <<"com.example.notfound_error">> =>#{
                                handler => {wamp_client_example, notfound_error}
                            },
                            <<"com.example.validation_error">> =>#{
                                handler => {wamp_client_example, validation_error}
                            },
                            <<"com.example.service_error">> =>#{
                                handler => {wamp_client_example, service_error}
                            },
                            <<"com.example.authorization_error">> =>#{
                                handler => {wamp_client_example, authorization_error}
                            },
                            <<"com.example.timeout">> =>#{
                                handler => {wamp_client_example, timeout}
                            }
                        }
                    },
                    subscriber => #{
                        features => #{},
                        subscriptions => #{
                            <<"com.example.onhello">> =>#{
                                handler => {wamp_client_example, onhello}
                            },
                            <<"com.example.onadd">> => #{
                                handler => {wamp_client_example, onadd}
                            }
                        }
                    }
                }
            }
        }}
    ]},

    {awre, [
        {erlbin_number, 15}
    ]},

    {kernel, [
        {logger, [
            {handler, wamp_client_handler, logger_std_h, #{
                formatter => {flatlog, #{
                    map_depth => 1,
                    term_depth => 50
                }}
                % ,
                % formatter => {logger_formatter, #{}}
            }}
        ]},
        {logger_level, info}
     ]},

    {lager,[{error_logger_hwm,100},
     {crash_log_count,5},
     {crash_log_date,"$D0"},
     {crash_log_size,10485760},
     {crash_log_msg_size,65536},
     {crash_log,"./log/crash.log"},
     {async_threshold_window,50},
     {async_threshold,500},
     {colored,true},
     {handlers,
         [{lager_console_backend,
              [{level,info},
               {formatter,lager_default_formatter}
            %    ,
            %    {formatter_config,
            %        [color,date," ",time," [",severity,"]"," [",pid,
            %         {module,[" ",module],[]},
            %         {function,[":",function],[]},
            %         {line,[":",line],[]},
            %         "] ",message,"\e[0m\r\n"]}
        ]}]},
     {error_logger_redirect,true}
    ]
    }
].
